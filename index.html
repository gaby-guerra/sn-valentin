<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Open Graph (Facebook, WhatsApp, etc.) -->
  <meta property="og:title" content="ðŸ’˜ Regalo de San ValentÃ­n Interactivo">
  <meta property="og:description" content="Genera tu regalo y compÃ¡rtelo ðŸ’Œ">
  <meta property="og:image" content="https://gaby-guerra.github.io/sn-valentin/preview.jpg">
  <meta property="og:image:secure_url" content="https://gaby-guerra.github.io/sn-valentin/preview.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://gaby-guerra.github.io/sn-valentin/">
  <meta property="og:type" content="website">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://gaby-guerra.github.io/sn-valentin/preview.jpg">

  <title>Regalo de San ValentÃ­n</title>

  <style>
    :root { --pad: 14px; }
    body { margin: 0; }
    .wrap {
      max-width: 720px;
      margin: 0 auto;
      padding: 18px var(--pad) 28px;
      display: grid;
      gap: 14px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    h1 { font-size: 20px; margin: 6px 0 0; }
    .sub { color:#556; font-size: 13px; margin: 0 0 6px; }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-items: end;
    }
    label { font-size: 13px; color:#334; display:block; margin-bottom: 6px; }
    select, input {
      width: 100%;
      padding: 10px 12px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid #d6dbe2;
      background: #fff;
      box-sizing: border-box;
    }
    .buttons { display:flex; gap:10px; flex-wrap: wrap; }
    button {
      padding: 10px 12px;
      font-size: 15px;
      border-radius: 12px;
      border: 1px solid #d6dbe2;
      background: #fff;
      cursor: pointer;
    }

    /* Billete */
    .bill {
      position: relative;
      width: 100%;
      aspect-ratio: 860 / 360;
      background: center/cover no-repeat;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.18);
    }
    .text {
      position: absolute;
      color: rgba(0,0,0,.95);
      font-weight: 900;
      letter-spacing: 0.5px;
      white-space: nowrap;
      font-size: clamp(16px, 3.8vw, 30px);

      /* plaquita para que siempre se lea */
      background: rgba(255,255,255,.72);
      padding: 6px 10px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0,0,0,.18);
      backdrop-filter: blur(2px);
    }
    .topLeft { top: 6%; left: 6%; }
    .bottomRight { bottom: 7%; right: 6%; }
    .hint { font-size: 12px; color:#667; }

    @media (max-width: 600px) {
      .controls { grid-template-columns: 1fr; }
      button { flex: 1 1 160px; }
      .text { font-size: clamp(14px, 5vw, 22px); }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>ðŸ’˜ Regalo de San ValentÃ­n</h1>
    <p class="sub">Elige, tu regalo GRATIS.</p>

    <div class="controls">
      <div>
        <label for="tipo">Â¿Piensa a quien le vas a regalar?</label>
        <select id="tipo">
          <option value="ABRAZOS">1. Un amig@</option>
          <option value="BESOS">2. Mas que amig@</option>
          <option value="CARICIAS">3. Mucho mas</option>
        </select>
      </div>
      <div>
        <label for="cantidad">Elige un numero mayor que 1 menor que 9999</label>
        <input id="cantidad" inputmode="numeric" type="number" min="2" max="9999" step="1" value="1000" />
      </div>
    </div>

    <div class="buttons">
      <button id="btnInline" type="button">Generar</button>
      <button id="btnDownload" type="button">Descargar imagen</button>
    </div>

    <div id="inlineOut" style="display:none;">
      <div class="bill" id="billInline" aria-label="Vale">
        <div class="text topLeft" id="t1"></div>
        <div class="text bottomRight" id="t2"></div>
      </div>
    </div>

    <p class="hint">Tip: genera â†’ toma screenshot â†’ comparte en WhatsApp o sÃºbelo a tu historia ðŸ˜„</p>
  </div>

  <!-- LibrerÃ­a para descargar el billete como imagen -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const tipo = document.getElementById("tipo");
    const cantidad = document.getElementById("cantidad");

    const inlineOut = document.getElementById("inlineOut");
    const t1 = document.getElementById("t1");
    const t2 = document.getElementById("t2");
    const billInline = document.getElementById("billInline");

    const fondos = {
      ABRAZOS: "./billete_abrazos.jpg",
      BESOS: "./billete_besos.jpg",
      CARICIAS: "./billete.jpg"
    };

    function formatEspacio(n) {
      return String(n).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }

    function getTexto() {
      const c = Math.max(1, parseInt(cantidad.value || "1", 10));
      return `${formatEspacio(c)} ${tipo.value}`;
    }

    function applyBackground() {
      const url = fondos[tipo.value] || fondos.ABRAZOS;
      billInline.style.backgroundImage = `url("${url}")`;
    }

    function renderInline() {
      applyBackground();
      const txt = getTexto();
      t1.textContent = txt;
      t2.textContent = txt;
    }

    function showInline() {
      inlineOut.style.display = "block";
      renderInline();
      inlineOut.scrollIntoView({ behavior: "smooth", block: "center" });
    }

    document.getElementById("btnInline").addEventListener("click", showInline);

    // Enter = generar
    cantidad.addEventListener("keydown", (e) => {
      if (e.key === "Enter") showInline();
    });

    // Si cambias el tipo, actualiza el billete si ya estÃ¡ visible
    tipo.addEventListener("change", () => {
      if (inlineOut.style.display !== "none") renderInline();
      else applyBackground();
    });

    // Descargar = (genera si hace falta) + descarga
    document.getElementById("btnDownload").addEventListener("click", async () => {
      inlineOut.style.display = "block";
      renderInline();
      await new Promise(requestAnimationFrame);

      if (typeof html2canvas !== "function") {
        alert("No se cargÃ³ html2canvas. Revisa tu conexiÃ³n e intenta de nuevo.");
        return;
      }

      try {
        const canvas = await html2canvas(billInline, {
          scale: 3,
          useCORS: true,
          backgroundColor: null
        });

        canvas.toBlob((blob) => {
          if (!blob) return;
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "vale-san-valentin.png";
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        }, "image/png");
      } catch (err) {
        console.error(err);
        alert("No se pudo descargar. Si estÃ¡s abriendo como archivo, prueba en GitHub Pages o en http://localhost.");
      }
    });

    applyBackground();
  </script>
</body>
</html>
